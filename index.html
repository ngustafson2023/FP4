<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calling Out Corporate</title>
    <link rel="stylesheet" href="style.css"> 
    <link rel="stylesheet" href="line-chart/public/build/bundle.css">
    <link rel="stylesheet" href="svelte-app/public/build/bundle.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
</head>
<body>
    <h1><strong>Calling Out Corporate:</strong> 
        <br> The Adverse Impacts of Corporate Ownership on Boston Communities
    </h1>

    <p>
        In recent years, the United States has witnessed a significant surge in both corporate ownership of properties and eviction rates, trends that can have profound implications on the socio-economic fabric of many communities. These issues have been particularly pronounced in cities like Boston, where a complex interplay of factors contributes to housing instability. Our team drew upon extensive data and research to explore the nexus between corporate ownership rates of properties and different characteristics of neighborhoods, discovering broader consequences of corporate ownership on communities in Boston.
    </p>

    <div class="column-flexbox">
        <div class="row-flexbox">
            <div class="text-container"> 
                <h2>The Escalating Trend of Evictions</h2>
                <p>A sweeping analysis of eviction records by the New York Times has highlighted an alarming increase in evictions not just in Boston but across America, with nearly one million American households facing eviction judgments in 2016 alone.<sup><a href="#fn-1">[1]</a></sup> This national crisis reflects deep-seated issues of housing affordability and tenant rights under increasing pressure from corporate property ownership.</p>
                <p>Evictions, a distressing reality for many American families, cast long shadows over communities, bringing forth a cascade of detrimental effects that transcend the immediate loss of a home. A review by the Harvard Medical School shows that the specter of eviction often forces families into substandard housing in less safe neighborhoods, exposing them to environmental hazards and high crime rates, and instigating a cycle of instability that is difficult to break.<sup><a href="#fn-2">[2]</a></sup> The educational disruption for children, often leading to poor academic performance and diminished future prospects, adds to the intergenerational impact of evictions. The loss of community support systems, essential for emotional well-being and practical assistance, exacerbates the isolation that evicted families face.</p>
            </div>

            <div class="visualization-container">
                <div class="fade-effect" id="svelte-app1"></div>
            </div>
        </div>

        <h2>Corporate Ownership and Its Discontents</h2>
        <p>In Boston specifically, the problem of higher eviction rates has been linked to the rise of corporate-owned rental properties. These entities often prioritize profit over tenant stability, leading to practices that can exacerbate housing insecurity. A report by Homes for All Massachusetts conducted between 2020 and 2021 reveals that neighborhoods with concentrated corporate ownership experience significantly higher eviction filing rates.<sup><a href="#fn-3">[3]</a></sup> This pattern is not coincidental but a direct consequence of investment strategies that favor returns over community welfare. Our housing data shows that Boston’s eviction rate has been heavily correlated to the corporate ownership rate in Boston over the last four years (correlation = 0.93), with evictions showing a strong upward trend since 2020 and corporate ownership rates rising in all Boston neighborhoods over the last twenty years.</p>
        <p>Although corporate ownership is increasing throughout Boston, there are some neighborhoods that are experiencing it more than others. Furthermore, corporate ownership can affect different neighborhoods differently, depending on neighborhood characteristics such as race, age, and median income. For example, HFA Mass found that the impact of corporate-driven evictions is disproportionately felt by communities of color and low-income families. In Massachusetts, their data demonstrates that neighborhoods predominantly inhabited by people of color and those with higher proportions of single mothers also see more frequent eviction filings. Using our housing data, our team put together three case studies below detailing how specific Boston neighborhoods have been experiencing the adverse impacts of corporate ownership, beyond just evictions. We find that multiple neighborhoods are experiencing demographic targeting in corporate ownership rising, which deepens existing inequalities and undermines efforts toward social equity.</p>

        <h2>Case Studies</h2>
        
        <div class="row-flexbox">
            <div class="text-container">
                <h3> Jamaica Plain and Longwood: Racial Displacement </h3>
                <p>The Jamaica Plain and Longwood neighborhoods in Boston stand as striking examples of how shifts in corporate ownership rates can ripple through communities, altering their demographic makeup. Our comprehensive analysis of Boston's housing data over the last two decades reveals a notable trend: as corporate ownership increases, the racial and ethnic demographics of a neighborhood can change dramatically. In Jamaica Plain and Longwood, this phenomenon has manifested as an increase in the white population alongside a decrease in the Black and Hispanic residents. These neighborhoods, once reflective of a diverse urban tapestry, have seen their cultural and racial landscapes transform.</p>
                <p>Below are three graphs plotting the correlation between corporate ownership rate and the proportion of the hispanic, black, and white population, respectively, as a percentage of the entire population, in each of the fifteen Boston neighborhoods we have housing data for. The correlations are shown over the time span of 2010 to 2020. Here, we especially call your attention to the Jamaica Plain and Longwood neighborhoods as they stand out amongst their peers.</p>
                <p>The correlation coefficients charting the relationship between corporate ownership rates and the proportion of Black/African American and Hispanic residents are strongly negative, while those showing the relationship between corporate ownership rates and the proportion of White residents are strongly positive. It suggests that as corporate entities acquire more properties in Jamaica Plain and Longwood, there is an inverse effect on these minority populations, hinting at a worrying trend of displacement or exclusion of traditional communities. The implications are multifaceted, affecting not just the cultural fabric but also the socio-economic structures within these neighborhoods.</p>
                <p>The correlation graphs exhibit more than just numbers—they symbolize the ebbing away of long-standing communities and raise concerns about the erosion of affordable housing, potential cultural displacement, and the dilution of community voices that have historically shaped these neighborhoods' identities. They call into question the commitment to diversity and inclusivity in urban development policies and raise the specter of gentrification displacing minority communities.</p>
            </div>
            <div class="visualization-container">
                <div id="svelte-app2"></div>
            </div>
        </div>

        <div class="row-flexbox">
            <div class="text-container">
                <h3> Longwood: "Youthification" </h3>
                <p>Longwood's neighborhood demographic has been undergoing a significant shift toward a younger population, a trend deeply intertwined with the patterns of corporate property ownership. The data paints a clear picture: an increase in corporate ownership correlates strongly with a rise in the proportion of the younger population, specifically among those aged 10-34, while the older age brackets, notably those 65 and above, are seeing a highly correlated decline. This change is evident from the evolving age distribution, which in 2017 showed that a staggering 89% of Longwood's residents were young adults, contrasting sharply with just 15% in the broader Boston area.<sup><a href="#fn-4">[4]</a></sup></p>
                <p>This demographic tilt toward youth reflects broader trends in urban development and has significant implications for the neighborhood. The influx of younger residents, often driven by the allure of modernized, corporate-owned properties, comes at a cost to the elderly population, who may find themselves economically and socially sidelined. The dwindling numbers of the older demographic could lead to a reduction in age-diverse communities and a loss of the multigenerational fabric that once characterized areas like Longwood.</p>
                <p>Longwood's data reveals a telling trend: the more substantial presence of young adults and college students, with a staggering 93% of residents enrolled in higher education institutions in 2017. This educational makeup aligns with the interests of corporate owners who target this demographic for their proximity to universities and hospitals. However, this focus on the youth market could potentially marginalize older, long-standing residents, threatening the inclusivity and diversity of the neighborhood.</p>
                <p>Furthermore, the shift may also lead to the erosion of services and community structures that cater to an older population, from healthcare to social venues, altering the neighborhood's needs and resource allocation. The older demographic's decline, indicated by the negative correlation coefficients, suggests a departure from a traditionally diverse age community, moving towards a transient, younger populace, less invested in the long-term stability and continuity of community life.</p>
            </div>
            <div class="visualization-container">
                <div class="image-container">
                    <img src="images/Longwood_10-19 years.png" class="image fade-effect">
                </div>
            </div>
        </div>

        <div class="row-flexbox">
            <div class="text-container"> 
                <h3>Longwood and Brighton: The Loss of Housing Occupancy</h3>
                <p>Longwood and Brighton, two distinct neighborhoods within Boston, have experienced a striking negative correlation between corporate ownership rates and the overall rate of occupied housing units over the past decade. This trend points to a less visible, yet impactful side of corporate investment in residential property: a decrease in the stable, long-term residency that forms the backbone of thriving communities. With corporate ownership prioritizing profitability and often targeting a transient demographic, such as students or temporary workers, we see a ripple effect that extends beyond the housing market to the social fabric of the neighborhood itself.</p>
                <p>In Longwood, a predominantly young adult population, with a high percentage enrolled in higher education and linked to healthcare professions, reflects a transitory nature of residency that dovetails with the objectives of corporate landlords. Such properties are more likely to cater to renters seeking short-term leases, contributing to a decrease in owner-occupied units, which can suggest a lower level of community attachment and investment. Brighton, while still maintaining a considerable rate of owner-occupied units, exhibits a similar trend, with a notable portion of housing being renter-occupied. The growing diversity and influx of younger demographics, alongside rising vehicle ownership, points to a changing neighborhood profile that aligns with an increase in corporate-owned rental properties.<sup><a href="#fn-5">[5]</a></sup></p>
                <p>These correlations signal potential concerns for neighborhoods in transition. A lower rate of owner-occupancy often equates to reduced local engagement and investment in communal amenities and infrastructure. It may also reflect a real estate market that's shifting away from family-owned homes towards more transient, corporate-owned rental properties, which can lead to a less stable resident population. This instability can impact local schools, businesses, and community organizations, all of which rely on a stable population to thrive.</p>
                <p>The negative correlation in Longwood and Brighton between corporate ownership and occupied housing units raises questions about the sustainability of community dynamics. The increasing presence of corporate owners can inadvertently lead to neighborhoods that are less resilient in the face of economic or social upheaval, given that fewer long-term residents are on hand to weather such changes.</p>
            </div>

            <div class="visualization-container">
                <div class="image-container">
                    <img src="images/Brighton_Longwood_Occupied Housing Units.png" class="image fade-effect">
                </div>
            </div>
        </div>
    </div>

    <h2> Implications for Policy Making and Community Planning</h2>
    <p>
        The case studies of Jamaica Plain, Longwood, and Brighton provide a rich tapestry of data highlighting the nuanced effects of corporate property ownership on neighborhoods' socio-economic fabric. Policymakers and urban planners face the challenge of balancing growth and development with preserving community integrity and stability. The shift towards younger demographics in Longwood, the changing racial and age profile in Jamaica Plain, and the correlation between corporate ownership and housing occupancy rates in both Longwood and Brighton underscore a need for housing policies that support long-term residency and promote demographic diversity.
        <br><br>
        Strategies could include encouraging the development of mixed-housing projects that provide both affordable and market-rate options, thereby supporting a more stable owner-occupancy rate while still accommodating the necessary rental market. Additionally, community planning must account for the transient nature of renter-majority neighborhoods by providing services and amenities that cater to both short-term and long-term residents, ensuring that community engagement doesn't falter as the population ebbs and flows.
        <br><br>
        The correlation data also points to the importance of regulatory oversight to prevent displacement, particularly of lower-income and older residents, and to ensure that corporate-owned properties contribute positively to the community. This might take the form of incentivizing corporate landlords to invest in neighborhood improvements or mandating a percentage of long-term leases in their property portfolios.
        <br><br>
        In essence, the underlying message for policymakers is that neighborhoods thrive on stability and continuity. By creating frameworks that encourage owner occupancy and long-term tenancy, Boston can foster neighborhoods that are not only economically diverse and vibrant but also rich in community spirit and resilience. This holistic approach to urban development is crucial for shaping neighborhoods that are not just places of residence but also nurturing environments for future generations.
        <br><br>
        We focused on how corporate ownership rates increasing has had adverse impacts on the specific neighborhoods of Longwood, Jamaica Plain, and Brighton. However, we know that corporate ownership rates are increasing everywhere in Boston. We encourage you to explore the comprehensive dataset of correlations between corporate ownership rate and various neighborhood characteristics, shown on the map below for all fifteen Boston neighborhoods we have data for. Further click into a neighborhood to see how the characteristics of these neighborhoods have shifted over time.
    </p>

    <h2> Interactive Visualization </h2>
    <h3 id="viz-title">Correlation of Demographic Characteristics with Corporate Ownership Rate in Boston</h3>
    <div id="viz-container">
        <div id="nick-container">
            <div id="map">
                <div id="mapDropdown" style="text-align:center; margin-top: 5px; margin-bottom: 10px;">
                    <h4 id="selector-title"><b>Select a Demographic Characteristic:</b></h4>
                    <select id="dataSelector" onchange="updateDataLayer(this.value)">
                        <option value="White">White</option>
                        <option value="Black/ African American">Black/ African American</option>
                        <option value="Asian/PI">Asian/PI</option>
                        <option value="Hispanic">Hispanic</option>
                        <option value="Foreign Born">Foreign Born</option>
                        <option value="0-9 years">0-9 years</option>
                        <option value="10-19 years">10-19 years</option>
                        <option value="20-34 years">20-34 years</option>
                        <option value="35-54 years">35-54 years</option>
                        <option value="55-64 years">55-64 years</option>
                        <option value="65 years and over">65 years and over</option>
                        <option value="Occupied Housing Units">Occupied Housing Units</option>
                        <option value="Owner-occupied">Owner-occupied</option>
                        <option value="Renter-occupied">Renter-occupied</option>
                        <option value="Population">Population</option>
                        <option value="Other">Other</option>
                        <option value="less than High School">less than High School</option>
                        <option value="High School or GED">High School or GED</option>
                        <option value="Some College or Associate's Degree">Some College or Associate's Degree</option>
                        <option value="Bachelor's Degree or Higher">Bachelor's Degree or Higher</option>
                    </select>
                </div>
                <div id="info" class="info">Hover over a neighborhood to view</div>
                <div id="legend">
                    <div style="background: linear-gradient(to right, blue, white, red); width: 100%; height: 20px;"></div>
                    <div style="display: flex; justify-content: space-between; font-size: 12px; margin-top: 4px;">
                        <span>-1</span>
                        <span>0</span>
                        <span>+1</span>
                    </div>
                </div>
            </div>
        </div>
        <div id="stephen-container">
            <h2 id="line-title" style="text-align: center; margin-top:10px; margin-bottom: 20px;"></h2>
            <div style="display: flex; flex-direction: row; justify-content: space-between;">
                <div id="lineDropdown" style="font-size: 14px; font-weight: bold">
                    <label for="factor">Choose a factor:</label> 
                    <select name="factor" id="factor" onchange="plotFactor(this.value)"> 
                        <option value="age">Age</option> 
                        <option value="race">Race</option> 
                        <option value="education">Education</option> 
                    </select>
                </div>
            </div>
            <div id="chart-container"></div>
            <div style="text-align: center;">
                <h3>Year: <span id="yearDisplay">2000</span></h3>
                <input type="range" id="yearSlider" min="2000" max="2020" value="2000" step="1" oninput="updateChart(this.value)" style="width: 100%;">
                <small>Drag slider to change year.</small>
                <!-- <button id="autoplayStart">Start Autoplay</button>
                <button id="autoplayStop">Stop Autoplay</button> -->
            </div>
        </div>
    </div>

    <div class="footnotes">
        <h2>References</h2>
        <ol>
            <li id="fn-1"><a href="https://www.nytimes.com/interactive/2018/04/07/upshot/millions-of-eviction-records-a-sweeping-new-look-at-housing-in-america.html?smid=pl-share">New York Times, 2018</a></li>
            <li id="fn-2"><a href="https://hms.harvard.edu/news/evictions-haunt-families-harm-childrens-health ">Harvard Medical School, 2023</a></li>
            <li id="fn-3"><a href="https://www.homesforallmass.org/covid-evictions-report/hfamass-covid-evictions-report-short-03-22-print-hr.pdf">Homes for All Massachusetts, 2022</a></li>
            <li id="fn-4"><a href="http://www.bostonplans.org/getattachment/25935f3a-9648-4a72-a165-f93e57919204">Boston Planning & Development Agency Research Division -- Longwood, 2019</a></li>
            <li id="fn-5"><a href="http://www.bostonplans.org/getattachment/8f4b84d5-a65f-469e-87ca-665f096b73bf">Boston Planning & Development Agency Research Division -- Brighton, 2019</a></li>
        </ol>
    </div>

    <script src="line-chart/public/build/bundle.js"></script>
    <script src="svelte-app/public/build/bundle.js"></script>

    <script>

        document.addEventListener("DOMContentLoaded", function() {
            var allElements = document.querySelectorAll('h1, h2, h3, h4, h5, h6, p, li');
            allElements.forEach(function(element) {
                element.classList.add('fade-effect');
            });
        });

        document.addEventListener("DOMContentLoaded", function() {
            const elements = document.querySelectorAll('.fade-effect');
            let scrollDir = 'down';
            let lastScroll = window.pageYOffset;
            window.addEventListener('scroll', () => {
                scrollDir = window.pageYOffset > lastScroll ? 'down' : 'up';
                lastScroll = window.pageYOffset;
            });
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.animationName = scrollDir === 'down' ? 'fadeInUp' : 'fadeInDown';
                    } else {
                        if (scrollDir === 'down') {
                            entry.target.style.animationName = 'fadeOutUp';
                        } else {
                            entry.target.style.animationName = 'fadeOutDown';
                        }
                    }
                });
            }, { 
                threshold: 0.5,
                rootMargin: '-2% 0px -2% 0px'
             });
            elements.forEach(el => {
                observer.observe(el);
            });
        });

        var selectedFactor = 'White';
            
            function updateDataLayer(factor) {
                selectedFactor = factor;
                refresh();
            }

            var map;
            function initMap() {
                if (map) {
                    map.remove();
                }

                var zoom = 12;
                map = L.map('map', {
                    zoomSnap: 0,
                    maxZoom: zoom,
                    minZoom: zoom,
                    zoomControl: false,
                    doubleClickZoom: false,
                    scrollWheelZoom: false,
                    dragging: false,
                }).setView([42.313, -71.05977], zoom);
                var tiles = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                    attribution: ''
                }).addTo(map);
                refresh();
            }
            initMap();
            
            var geojson;
            function highlightFeature(e) {
                var layer = e.target;
                const feature = e.target.feature;
                const cor = feature.properties[selectedFactor];
                layer.setStyle({
                    weight: cor !== undefined ? 5 : 0,
                    color: '#666',
                    dashArray: ''
                });
                if (cor !== undefined) {
                    const info = document.getElementById('info');
                    info.style.display = 'block';
                    info.innerHTML = '<h4>Correlation with Corporate Ownership Rate</h4>' +
                        '<b>' + feature.properties.namer + ': </b>' + 
                        cor.toFixed(2);
                    info.style.left = (e.originalEvent.clientX + 15) + 'px';
                    info.style.top = (e.originalEvent.clientY + 15) + 'px';
                }
            }

            function resetHighlight(e) {
                geojson.resetStyle(e.target);
                e.target.setStyle(style(e.target.feature));
                const info = document.getElementById('info');
                info.style.display = 'none';
                info.innerHTML = 'Hover over a neighborhood to view';
            }

            function selectNeighborhood(e) {
                var layer = e.target;
                selectedNeighborhood = layer.feature.properties.namer;
                plotFactor("age");
            }

            function onEachFeature(feature, layer) {
                if (feature.properties[selectedFactor] !== undefined) {
                    layer.on({
                        mouseover: highlightFeature,
                        mouseout: resetHighlight,
                        click: selectNeighborhood
                    });
                } else {
                    layer.on({
                        mouseover: function(e) {
                            e.target._path.style.cursor = 'default';
                        },
                        mouseout: function(e) {
                            e.target._path.style.cursor = 'default';
                        }
                    });
                }
            }

            function getColor(cor) {
                var r, g, b;
                if (cor < 0) {
                    r = g = Math.round(255 * (cor + 1));
                    b = 255;
                } else {
                    r = 255;
                    g = b = Math.round(255 * (1 - cor));
                }
                return `rgb(${r}, ${g}, ${b})`;
            }

            function style(feature) {
                const cor = feature.properties[selectedFactor];
                return {
                    fillColor: cor !== undefined ? getColor(cor) : '#cccccc',
                    weight: cor !== undefined ? 2: 0,
                    opacity: 1,
                    color: 'black',
                    dashArray: '',
                    fillOpacity: cor !== undefined ? 1 : 0
                };
            }
            
            function refresh() {
                fetch('data.geojson')
                .then(response => response.json())
                .then(data => {
                    geojson = L.geoJSON(data, {
                        style: function(feature) {
                            return style(feature); 
                        },
                        onEachFeature: onEachFeature
                    }).addTo(map);
                });
            }
            refresh();
        
            /* For Stephen */
            // define line graph elements
            let selectedNeighborhood = "Allston";

            const colors = ['#1f77b4','#ff7f0e','#2ca02c','#d62728','#9467bd','#8c564b','#e377c2','#7f7f7f', '#bcbd22', '#17becf'];
            // const colors = ['#e41a1c','#377eb8','#4daf4a','#984ea3','#ff7f00','#a65628','#f781bf','#999999'];
            const chartWidth = 600;
            const chartHeight = 400;
            const margin = {top: 50, right: 50, bottom: 100, left: 50}; 
            const width = chartWidth - margin.left - margin.right;
            const height = chartHeight - margin.top - margin.bottom;

            const xScale = d3.scaleLinear()
                .domain([2000, 2020])
                .range([0, width]);

            const yScale = d3.scaleLinear()
                .domain([0, 100])
                .range([height, 0]);

            const xAxis = d3.axisBottom(xScale).tickFormat(d3.format("d"));
            const yAxis = d3.axisLeft(yScale);
            const yAxisRight = d3.axisRight(yScale);

            const area = d3.area()
                .x((d, i) => xScale(years[i]))
                .y1(d => yScale(d))
                .y0(yScale(0))
                .curve(d3.curveMonotoneX);

        function plotFactor(factor) {
            d3.select("#chart-container").selectAll("*").remove();
            var select = document.getElementById("factor");
            var selectedLineFactor = select.options[select.selectedIndex].text;
            document.getElementById('line-title').innerHTML = `${selectedLineFactor} Distribution in ${selectedNeighborhood}`
            years = [];
            factorPoints = {};
            paths = {};
            if (factor == "age") {
                factors = ["0-9 years","10-19 years","20-34 years","35-54 years","55-64 years","65 years and over"]
            } else if (factor == "race") {
                factors = ["White","Black/ African American","Hispanic","Asian/PI","Other"]
            } else if (factor == "education") {
                factors = ["less than High School", "High School or GED", "Some College or Associate's Degree", "Bachelor's Degree or Higher"]; // from dropdown to choose factor
            }

            d3.csv("./Boston_Neighborhood_Census_Data (2000, 2010, 2015, 2017, 2020) - extrapolated.csv").then(function(data) {
                const selectedNeigh = data.filter(d => d.Neighborhood === selectedNeighborhood);
                const selectedValues = {};
                var sumFactors = {};
                selectedNeigh.forEach(d => {
                    sumFactors[d["Year"]] = 0;
                    factors.forEach(column => {
                    sumFactors[d["Year"]] += parseFloat(d[column]);
                    });
                });
                selectedNeigh.forEach(d => {
                    var runningSum = 0
                    factors.forEach(column => {
                        if (!selectedValues[d["Year"]]) {
                            selectedValues[d["Year"]] = {};
                        }
                        const proportion = 100 * d[column] / sumFactors[d["Year"]];
                        selectedValues[d["Year"]][column] = 100 - runningSum;
                        runningSum += proportion;
                    });
                });
                years = Object.keys(selectedValues)
                factors.forEach(d => {
                    factorPoints[d] = years.map(year => selectedValues[year][d])
                });

                const svg = d3.select("#chart-container")
                    .append("svg")
                    .attr("width", chartWidth)
                    .attr("height", chartHeight)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                svg.append("g") //x-axis
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis)
                    .append("text")
                    .attr("x", width / 2)
                    .attr("y", 40)
                    .attr("text-anchor", "middle")
                    .attr("fill", "black")
                    .attr("font-weight", "bold")
                    .style("font-size", "12px")
                    .text("Year");
                svg.append("g") //y-axis left
                    .call(yAxis)
                    .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", -50)
                    .attr("x", -height / 2)
                    .attr("dy", "0.71em")
                    .attr("text-anchor", "middle")
                    .attr("fill", "black")
                    .attr("font-weight", "bold")
                    .style("font-size", "12px")
                    .text("Percentage");
                svg.append("g") //y-axis right
                    .attr("transform", "translate(" + width + ",0)")
                    .call(yAxisRight)
                    .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", -50)
                    .attr("x", height / 2)
                    .attr("dy", "0.71em")
                    .attr("text-anchor", "middle")
                    .attr("fill", "black")
                    .attr("font-weight", "bold")
                    .style("font-size", "12px")

                const legend = svg.append("g")
                .attr("class", "legend")
                .attr("transform", "translate(0," + (height + margin.bottom / 2) + ")");

                const legendItemWidth = 360; 

                for (let i = 0; i < factors.length; i++) {
                    const f = factors[i];
                    const color = colors[i];
                    const row = Math.floor(i / 2); 
                    const col = i % 2

                    const path = svg.append("path")
                    .datum(factorPoints[f])
                    .attr("fill", color)
                    .attr("stroke", color)
                    .attr("stroke-width", 1)
                    .attr("d", area);
                    paths[f] = path;
                    ; 
                    const legendItem = legend.append("g")
                        .attr("transform", "translate(" + (col * legendItemWidth) + "," + (row * 20) + ")");
                    legendItem.append("circle") // add colored dots to legend
                        .attr("cx", 0)
                        .attr("cy", 0)
                        .attr("r", 6)
                        .style("fill", color);
                    legendItem.append("text") // add text to legend
                        .attr("x", 10)
                        .attr("y", 0)
                        .attr("dy", "0.35em")
                        .style("font-size", "12px")
                        .text(f);
                }
                updateChart(2000);
                document.getElementById("yearSlider").value = 2000;
                startAutoplay()
            });

        }
        plotFactor("age");
        
        let autoplayInterval;
        function startAutoplay() {
            const slider = document.getElementById("yearSlider");
            let year = parseInt(slider.value);
            const maxYear = parseInt(slider.max);
            
            autoplayInterval = setInterval(() => {
                if (year < maxYear) {
                    year++;
                    slider.value = year;
                    var event = new Event('input', { bubbles: true,});
                    slider.dispatchEvent(event);
                } else {
                    stopAutoplay();
                }
            }, 500);
        }

        function stopAutoplay() {
            clearInterval(autoplayInterval);
        }

        // Add event listeners to start and stop autoplay
        // document.getElementById("autoplayStart").addEventListener("click", startAutoplay);
        document.getElementById("yearSlider").addEventListener("mouseover", stopAutoplay);
        document.getElementById("lineDropdown").addEventListener("click", stopAutoplay);
        document.getElementById("map").addEventListener("click", stopAutoplay);

        function updateChart(year) {
            const index = years.findIndex(y => y === year);
            
            for (const factor of factors) {
                const values = factorPoints[factor].slice(0, index + 1);
                paths[factor].attr("d", area(values));
            }
            document.getElementById('yearDisplay').textContent = year;
        }
    </script>
</body>
</html>
